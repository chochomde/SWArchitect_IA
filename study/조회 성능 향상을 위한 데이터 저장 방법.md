### 조회 성능 향상을 위한 데이터 저장 방법



### 질문

```
사용자 정보를 관리하는 마이크로 서비스의 아키텍처 정의서를 작성 중 입니다. 해당 마이크로 서비스의 대부분 트랜잭션은 조회이기 때문에 조회 성능이 중요합니다. 조회 성능 향상을 위한 설계 전략으로 아래와 같이 선정하였습니다.
- 제목 : 조회 성능 향상을 위한 데이터 저장 방법
설계 전략은 데이터를 비정규화해서 저장하려고 합니다.설계 전략 선정 이유를 알려주세요. 그리고 비정규화하는 방법과 다른 한가지를 비교해서 설계 전략을 상세히 설명해주세요
```



#### 설계 전략 선정 이유

대부분의 트랜잭션이 조회 작업인 마이크로 서비스에서는 데이터 조회 성능이 시스템의 주요 성능 지표입니다. 이를 향상시키기 위해 데이터 비정규화 전략을 채택하면 조인 연산을 줄이고, 데이터 접근 속도를 크게 향상시킬 수 있습니다. 비정규화는 중복된 데이터를 허용하여 복잡한 조인을 피하고, 데이터 조회 시 일관되고 빠른 성능을 제공합니다.

### 설계 전략 상세

#### 설계 전략 1: 데이터 비정규화

**비정규화하는 방법:**

1. **중복 데이터 허용:** 데이터를 비정규화하여 필요한 정보를 중복 저장합니다. 예를 들어, 사용자의 주문 내역을 조회할 때 주문 테이블과 사용자 테이블을 조인하는 대신, 주문 테이블에 사용자 정보를 중복 저장합니다.
2. **최소한의 조인:** 데이터 조회 시 필요한 모든 정보를 한 테이블에 포함시켜 조인 연산을 최소화합니다.
3. **데이터 모델링:** 각 조회 트랜잭션에 최적화된 테이블 구조를 설계합니다. 주요 조회 패턴을 분석하여 자주 사용하는 데이터를 하나의 테이블에 비정규화합니다.
4. **인덱스 생성:** 비정규화된 테이블에 대해 적절한 인덱스를 생성하여 조회 속도를 높입니다.
5. **데이터 일관성 유지:** 비정규화로 인한 데이터 중복을 관리하기 위한 트리거 또는 애플리케이션 로직을 통해 데이터 일관성을 유지합니다.

**장점:**

- **빠른 조회 속도:** 조인 연산 없이 필요한 데이터를 바로 조회할 수 있어 속도가 빠릅니다.
- **단순한 쿼리:** 조회 쿼리가 단순해져서 데이터베이스 부하가 줄어듭니다.

**단점:**

- **데이터 중복:** 데이터 중복으로 인해 저장 공간이 늘어나고, 중복된 데이터를 일관성 있게 유지하기 어려울 수 있습니다.
- **데이터 업데이트 복잡성:** 중복된 데이터를 수정할 때 여러 테이블을 수정해야 하므로 복잡성이 증가합니다.

#### 설계 전략 2: 캐싱

**캐싱하는 방법:**

1. **자주 조회되는 데이터 캐싱:** 자주 조회되는 데이터나 반복적인 조회 패턴을 가진 데이터를 캐시합니다. 예를 들어, 사용자 프로필 정보는 자주 조회되므로 메모리 기반 캐시(예: Redis, Memcached)에 저장합니다.
2. **캐시 계층 추가:** 애플리케이션과 데이터베이스 사이에 캐시 계층을 추가하여 데이터베이스에 대한 직접적인 접근을 줄입니다.
3. **캐시 적중률 최적화:** 캐시 적중률을 높이기 위해 데이터 접근 패턴을 분석하고, 적절한 캐시 만료 정책을 설정합니다.
4. **캐시 일관성 관리:** 데이터베이스 업데이트 시 캐시도 함께 갱신하여 일관성을 유지합니다.

**장점:**

- **고속 데이터 접근:** 메모리 기반의 캐시는 데이터베이스보다 훨씬 빠른 속도로 데이터를 반환합니다.
- **데이터베이스 부하 감소:** 캐시를 통해 많은 조회 요청을 처리함으로써 데이터베이스 부하가 줄어듭니다.

**단점:**

- **캐시 일관성 문제:** 데이터베이스와 캐시 사이의 데이터 일관성을 유지하는 것이 복잡할 수 있습니다.
- **추가 인프라 관리:** 캐시 시스템을 관리하고 운영하는 추가적인 인프라가 필요합니다.

### 결론

**비정규화**와 **캐싱**은 조회 성능을 향상시키기 위한 두 가지 유효한 전략입니다. 비정규화는 데이터 조회 시 조인 연산을 줄이고, 단순한 쿼리를 통해 빠른 응답을 제공합니다. 그러나 데이터 중복과 일관성 유지의 어려움이 있습니다. 캐싱은 메모리 기반의 빠른 데이터 접근을 가능하게 하며, 데이터베이스의 부하를 줄입니다. 하지만 캐시 일관성 문제와 추가 인프라 관리의 복잡성이 따릅니다.

시스템의 특성과 요구사항에 따라 비정규화와 캐싱 전략을 적절히 결합하여 사용하면 조회 성능을 최적화할 수 있습니다. 예를 들어, 주요 데이터는 비정규화하여 데이터베이스에 저장하고, 자주 조회되는 데이터를 캐시하는 방식으로 성능을 극대화할 수 있습니다.